<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>26ai ORDS Lab - CI Compose Labs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        .header-section {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 3rem;
            border-radius: 0.5rem;
        }
        .step-card {
            margin-bottom: 2rem;
            border-left: 4px solid #dc3545;
        }
        .step-number {
            background: #dc3545;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
            padding: 1rem;
            margin: 0.5rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        .highlight-box {
            background-color: #e7f3ff;
            border-left: 4px solid #0d6efd;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.25rem;
        }
        .warning-box {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.25rem;
        }
        img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section text-center">
            <h1 class="display-4 mb-3"><i class="bi bi-cpu"></i> 26ai ORDS Lab</h1>
            <p class="lead">Deploy Oracle Database with ORDS and SQL CLI</p>
        </div>

        <div class="row">
            <div class="col-lg-10 mx-auto">
                <!-- Introduction -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0"><i class="bi bi-info-circle"></i> Lab Overview</h5>
                    </div>
                    <div class="card-body">
                        <p>This lab demonstrates how to deploy Oracle Database with Oracle REST Data Services (ORDS) using OCI Container Instances. This lab is based on the blog by Anders Swanson at <a href="https://andersswanson.dev/2025/12/12/oracle-rest-data-services-ords-with-docker-compose/" target="_blank" class="text-decoration-none">https://andersswanson.dev/2025/12/12/oracle-rest-data-services-ords-with-docker-compose/</a> with small modifications.</p>
                        <p><strong>How to run this lab:</strong></p>
                        <ul>
                            <li><a href="#prerequisites">Run the lab manually</a> - Follow the step-by-step instructions below</li>
                            <li><a href="#docker-compose-example">Start with Docker Compose</a> - Import the Docker Compose YAML example for quick setup</li>
                        </ul>
                        <p>You'll learn how to:</p>
                        <ul>
                            <li>Configure OCI resources (VCN, Object Storage)</li>
                            <li>Set up Oracle Database with ORDS</li>
                            <li>Use SQL CLI for database initialization</li>
                            <li>Integrate Object Storage for SQL scripts</li>
                        </ul>
                    </div>
                </div>

                <!-- Prerequisites -->
                <div id="prerequisites" class="card mb-4 shadow-sm step-card">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0"><i class="bi bi-check-circle"></i> Prerequisites</h5>
                    </div>
                    <div class="card-body">
                        <ul class="mb-0">
                            <li>Have OCI CLI configured</li>
                            <li>Have a compartment configured in your tenancy</li>
                        </ul>
                    </div>
                </div>

                <!-- Step 1: OCI Setup -->
                <div class="card mb-4 shadow-sm step-card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <span class="step-number">1</span>
                            OCI Infrastructure Setup
                        </h5>
                    </div>
                    <div class="card-body">
                        <h6 class="mt-3 mb-3">Create VCN with Public Subnet</h6>
                        <p>Create a Virtual Cloud Network (VCN) with a public subnet using Cloud UI and configure security rules to allow traffic to port 8080.</p>
                        <div class="code-block">
                            <strong>Action:</strong> Create VCN with Public Subnet using Cloud UI<br>
                            <strong>Security Rule:</strong> Allow inbound traffic to port 8080 from tenancy
                        </div>

                        <h6 class="mt-4 mb-3">Create Object Storage Bucket</h6>
                        <p>Create an OCI Object Storage bucket named <code>oracledb</code>.</p>
                        <div class="code-block">
                            <strong>Bucket Name:</strong> oracledb
                        </div>

                        <h6 class="mt-4 mb-3">Add SQL Initialization File to Bucket</h6>
                        <p>Upload a file named <code>ords_sql.init</code> to the <code>oracledb</code> bucket with the following content:</p>
                        <div class="code-block">
                            <strong>Object Name:</strong> ords_sql.init<br>
                            <strong>Bucket:</strong> oracledb<br>
                            <strong>Content:</strong><br>
                            <pre>-- Set as appropriate for your database.
alter session set container = freepdb1;

create user testuser identified by testpwd;
grant create session to testuser;
grant unlimited tablespace to testuser;
grant connect, resource to testuser;</pre>
                        </div>
                        <div class="highlight-box">
                            <strong><i class="bi bi-lightbulb"></i> Note:</strong> This SQL script is based on <a href="https://github.com/anders-swanson/oracle-database-code-samples/blob/main/ords-docker-compose/oracle/ords_init.sql" target="_blank" class="text-decoration-none">https://github.com/anders-swanson/oracle-database-code-samples/blob/main/ords-docker-compose/oracle/ords_init.sql</a>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Configure CI Compose -->
                <div class="card mb-4 shadow-sm step-card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <span class="step-number">2</span>
                            Configure CI Compose
                        </h5>
                    </div>
                    <div class="card-body">
                        <ol>
                            <li class="mb-3">
                                <strong>Set CI Name:</strong> <code>ords</code>
                            </li>
                            <li class="mb-3">
                                <strong>Set Compartment:</strong> Select your configured compartment
                            </li>
                            <li class="mb-3">
                                <strong>Select Subnet:</strong> Choose the public subnet created in Step 1
                            </li>
                        </ol>
                    </div>
                </div>

                <!-- Step 3: Create Container Instance -->
                <div class="card mb-4 shadow-sm step-card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <span class="step-number">3</span>
                            Create Container Instance
                        </h5>
                    </div>
                    <div class="card-body">
                        <ol>
                            <li class="mb-3">
                                Click <strong>"+ Create"</strong> on the Container Instances table header
                            </li>
                            <li class="mb-3">
                                Configure Instance Resources:
                                <ul class="mt-2">
                                    <li><strong>Memory:</strong> 32 GB</li>
                                    <li><strong>OCPUs:</strong> 2</li>
                                </ul>
                            </li>
                        </ol>
                    </div>
                </div>

                <!-- Step 4: Add Oracle Database Container -->
                <div class="card mb-4 shadow-sm step-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <span class="step-number">4</span>
                            Add Oracle Database Container
                        </h5>
                    </div>
                    <div class="card-body">
                        <ol>
                            <li class="mb-3">
                                Click <strong>"Add Container"</strong>
                            </li>
                            <li class="mb-3">
                                Configure the container:
                                <div class="code-block mt-2">
                                    <strong>Name:</strong> oracledb<br>
                                    <strong>Image:</strong> gvenzl/oracle-free:23.26.0-slim-faststart<br>
                                    <strong>Environment Variables:</strong><br>
                                    ORACLE_PASSWORD=Welcome12345
                                </div>
                            </li>
                            <li class="mb-3">
                                Click <strong>"Save"</strong>
                            </li>
                        </ol>
                    </div>
                </div>

                <!-- Step 5: Add ORDS Container -->
                <div class="card mb-4 shadow-sm step-card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <span class="step-number">5</span>
                            Add ORDS Container
                        </h5>
                    </div>
                    <div class="card-body">
                        <ol>
                            <li class="mb-3">
                                Click <strong>"Add Container"</strong>
                            </li>
                            <li class="mb-3">
                                Configure the container:
                                <div class="code-block mt-2">
                                    <strong>Name:</strong> ords<br>
                                    <strong>Image:</strong> container-registry.oracle.com/database/ords:25.4.0<br>
                                    <strong>Port:</strong> 8080 (name "http" optional)<br>
                                    <strong>Environment Variables:</strong><br>
                                    CONN_STRING=jdbc:oracle:thin:@127.0.0.1:1521/freepdb1, ORACLE_PWD=Welcome12345
                                </div>
                            </li>
                            <li class="mb-3">
                                Click <strong>"Save"</strong>
                            </li>
                        </ol>
                    </div>
                </div>

                <!-- Step 6: Add OsReader Sidecar -->
                <div class="card mb-4 shadow-sm step-card">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">
                            <span class="step-number">6</span>
                            Add OsReader Sidecar
                        </h5>
                    </div>
                    <div class="card-body">
                        <ol>
                            <li class="mb-3">
                                Click <strong>"Add Sidecar"</strong> and select <strong>OsReader</strong>
                            </li>
                            <li class="mb-3">
                                Click to edit the OsReader sidecar
                            </li>
                            <li class="mb-3">
                                Set environment variables:
                                <div class="code-block mt-2">
                                    data_path=/container-entrypoint-initdb.d, os_bucket=oracledb, reload_delay=0
                                </div>
                            </li>
                            <li class="mb-3">
                                Click <strong>"Save"</strong>
                            </li>
                        </ol>
                        <div class="highlight-box">
                            <strong><i class="bi bi-lightbulb"></i> Note:</strong> The OsReader sidecar will retrieve the SQL initialization script from Object Storage and make it available to the Oracle Database container.
                        </div>
                    </div>
                </div>

                <!-- Step 7: Add SQL CLI Container -->
                <div class="card mb-4 shadow-sm step-card">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">
                            <span class="step-number">7</span>
                            Add SQL CLI Container
                        </h5>
                    </div>
                    <div class="card-body">
                        <ol>
                            <li class="mb-3">
                                Click <strong>"Add Container"</strong>
                            </li>
                            <li class="mb-3">
                                Configure the container:
                                <div class="code-block mt-2">
                                    <strong>Name:</strong> sqlcli<br>
                                    <strong>Image:</strong> container-registry.oracle.com/database/sqlcl:latest<br>
                                    <strong>Command:</strong><br>
                                    bash, -c, sleep 45 && echo 'EXECUTE ORDS.ENABLE_SCHEMA; COMMIT;' | sql -s testuser/testpwd@127.0.0.1:1521/freepdb1
                                </div>
                                <div class="warning-box mt-2">
                                    <strong><i class="bi bi-exclamation-triangle"></i> Important:</strong> The command must be entered as comma separated (bash, -c, and the full command) in the Command field, not as environment variables.
                                </div>
                            </li>
                            <li class="mb-3">
                                Click <strong>"Save"</strong>
                            </li>
                        </ol>
                    </div>
                </div>

                <!-- Step 8: Add Volume -->
                <div class="card mb-4 shadow-sm step-card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <span class="step-number">8</span>
                            Add Volume
                        </h5>
                    </div>
                    <div class="card-body">
                        <ol>
                            <li class="mb-3">
                                Click <strong>"Add Volume"</strong>
                            </li>
                            <li class="mb-3">
                                Configure:
                                <div class="code-block mt-2">
                                    <strong>Path:</strong> /container-entrypoint-initdb.d<br>
                                    <strong>Name:</strong> oracledb (optional)
                                </div>
                            </li>
                            <li class="mb-3">
                                Click <strong>"Save"</strong>
                            </li>
                        </ol>
                    </div>
                </div>

                <!-- Step 9: Deploy -->
                <div class="card mb-4 shadow-sm step-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <span class="step-number">9</span>
                            Deploy Container Instance
                        </h5>
                    </div>
                    <div class="card-body">
                        <ol>
                            <li class="mb-3">
                                Click the <strong>"Next"</strong> button to review the summary
                            </li>
                            <li class="mb-3">
                                Review the configuration summary
                            </li>
                            <li class="mb-3">
                                Click the <strong>"Create"</strong> button
                            </li>
                            <li class="mb-3">
                                Wait for the Container Instance deployment <strong>"ords 1"</strong> to become green (running)
                            </li>
                        </ol>
                        <div class="mt-4">
                            <h6>Screenshot: Container Instance Summary</h6>
                            <img src="/images/ords-ci-summary.png" alt="Container Instance summary showing ords deployment configuration" class="img-fluid border rounded shadow-sm mb-3">
                            <p class="text-muted small">The Container Instance summary showing the ords deployment configuration before creation.</p>
                        </div>
                    </div>
                </div>

                <!-- Step 10: Verify Deployment -->
                <div class="card mb-4 shadow-sm step-card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <span class="step-number">10</span>
                            Verify Deployment
                        </h5>
                    </div>
                    <div class="card-body">
                        <ol>
                            <li class="mb-3">
                                Wait a minute or two for the deployment setup to complete
                            </li>
                            <li class="mb-3">
                                In the Container Instances table, click the <strong>"ords:8080"</strong> link
                            </li>
                            <li class="mb-3">
                                Test ORDS by logging in with:
                                <div class="code-block mt-2">
                                    <strong>Username:</strong> testuser<br>
                                    <strong>Password:</strong> testpwd
                                </div>
                            </li>
                        </ol>
                        <div class="mt-4">
                            <h6>Screenshot: Container Instances Table</h6>
                            <img src="/images/ords-container-instances.png" alt="Container Instances table showing ords deployment" class="img-fluid border rounded shadow-sm mb-3">
                            <p class="text-muted small">The Container Instances table showing the deployed ords instance with containers.</p>
                        </div>
                        <div class="mt-4">
                            <h6>Screenshot: ORDS Login</h6>
                            <img src="/images/ords-login.png" alt="ORDS login page" class="img-fluid border rounded shadow-sm mb-3">
                            <p class="text-muted small">The ORDS login page where you can test the deployment with testuser/testpwd credentials.</p>
                        </div>
                    </div>
                </div>

                <!-- Step 11: Cleanup -->
                <div class="card mb-4 shadow-sm step-card">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0">
                            <span class="step-number">11</span>
                            Cleanup
                        </h5>
                    </div>
                    <div class="card-body">
                        <ol>
                            <li class="mb-3">
                                Click the <strong>"Delete"</strong> button to delete the Container Instance deployment
                            </li>
                            <li class="mb-3">
                                Wait for the deletion to complete
                            </li>
                            <li class="mb-3">
                                Delete VCN/subnet with access allowed to port 8080 from tenancy using Cloud UI
                            </li>
                        </ol>
                        <div class="warning-box">
                            <strong><i class="bi bi-exclamation-triangle"></i> Note:</strong> Remember to clean up other OCI resources (Object Storage bucket) if they are no longer needed.
                        </div>
                    </div>
                </div>

                <!-- Docker Compose Example -->
                <div id="docker-compose-example" class="card mb-4 shadow-sm step-card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-file-code"></i> Docker Compose Example
                        </h5>
                    </div>
                    <div class="card-body">
                        <p>You can also import this lab configuration using Docker Compose YAML. Here's the compose file for this lab:</p>
                        <pre class="code-block"><code>version: '3.8'

services:
  ordsdb:
    image: gvenzl/oracle-free:23.26.0-slim-faststart
    container_name: ordsdb
    ports:
      - "1521:1521"
    environment:
      - ORACLE_PASSWORD=Welcome12345
    volumes:
      - ./oracle:/container-entrypoint-initdb.d
    # healthcheck is not supported in OCI - will be replaced with depends_on port check
    healthcheck:
      test: ["CMD-SHELL", "lsnrctl status | grep READY"]
      interval: 15s
      timeout: 10s
      retries: 5
      start_period: 30s

  ords:
    image: container-registry.oracle.com/database/ords:latest
    container_name: ords
    ports:
      - "8888:8080" # HTTP
      - "27017:27017" # MongoDB API
    environment:
      - CONN_STRING=jdbc:oracle:thin:@127.0.0.1:1521/freepdb1
      - ORACLE_PWD=Welcome12345
    volumes:
      - ./ords_config:/etc/ords/config
    depends_on:
      - ordsdb

  sqlcl:
    image: container-registry.oracle.com/database/sqlcl:latest
    container_name: sqlcl
    depends_on:
      - ords
    # Port check (1521) will be automatically added by parser via depends_on
    command:
      - bash
      - -c
      - echo 'EXECUTE ORDS.ENABLE_SCHEMA;' | sql -s testuser/testpwd@127.0.0.1:1521/freepdb1</code></pre>
                        <p class="text-muted small">Copy this YAML and use the "Import Compose" feature in CI Compose to quickly set up this lab configuration.</p>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="text-center mt-4 mb-4">
                    <a href="/labs.html" class="btn btn-outline-primary me-2">
                        <i class="bi bi-arrow-left"></i> Back to Labs
                    </a>
                    <a href="/" class="btn btn-outline-secondary">
                        <i class="bi bi-house"></i> Back to Main Application
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

