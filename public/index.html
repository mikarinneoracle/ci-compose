<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CI Compose</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">CI Compose</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <button class="nav-link btn btn-link text-white text-decoration-none" onclick="showConfigModal()">Configuration</button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link btn btn-link text-white text-decoration-none" onclick="showSidecarGalleryModal()">Sidecar Gallery</button>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white text-decoration-none" href="/labs.html" target="_blank" rel="noopener noreferrer">Labs</a>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link btn btn-link text-white text-decoration-none" onclick="showAboutModal()">About</button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container my-5">
        <div class="row">
            <div class="col-md-10 mx-auto">
                <!-- CI Name Display -->
                <div class="mb-4">
                    <h1 id="projectNameDisplay" class="display-5">CI Name</h1>
                </div>

                <!-- Main Content Row -->
                <div class="row">
                    <!-- Left Column: Container Instances -->
                    <div class="col-md-8">
                        <div class="card shadow">
                            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                <h3 class="mb-0"><i class="bi bi-stack"></i> Container Instances</h3>
                                <div class="d-flex align-items-center gap-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="showDeletedToggle" onchange="toggleDeletedCIs()">
                                        <label class="form-check-label text-white" for="showDeletedToggle" style="cursor: pointer;">
                                            Show Deleted
                                        </label>
                                    </div>
                                <button class="btn btn-info btn-sm" onclick="showImportDockerComposeModal()">
                                    <i class="bi bi-upload"></i> Import Compose
                                </button>
                                <button class="btn btn-light btn-sm" onclick="showCreateContainerInstanceModal()">
                                    + Create
                                </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="containerInstancesContent">
                                    <p class="text-muted">Loading container instances...</p>
                                </div>
                            </div>
                            <div class="card-footer bg-light" id="containerInstancesFooter">
                                <small class="text-muted" id="containerInstancesFooterText">Loading...</small>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Ports and Volumes -->
                    <div class="col-md-4">
                        <!-- Ports Card -->
                        <div class="card shadow mb-4">
                            <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                                <h3 class="mb-0"><i class="bi bi-ethernet"></i> Ports</h3>
                                <button class="btn btn-dark btn-sm" onclick="addPortToTable()">
                                    + Add Port
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-sm" id="portsTable">
                                        <thead class="table-light">
                                            <tr>
                                                <th colspan="2" style="border-bottom: 1px solid #dee2e6;">Port</th>
                                            </tr>
                                        </thead>
                                        <tbody id="portsTableBody">
                                            <tr>
                                                <td colspan="2" class="text-center text-muted">No ports added yet. Click "Add Port" to add one.</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="card-footer bg-light">
                                <small class="text-muted">Ports are container-specific and route traffic to their respective endpoints. Subnet security rules must be updated manually.</small>
                            </div>
                        </div>

                        <!-- Volumes Card -->
                        <div class="card shadow">
                            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                                <h3 class="mb-0"><i class="bi bi-hdd"></i> Volumes</h3>
                                <button class="btn btn-light btn-sm" onclick="addVolumeToTable()">
                                    + Add Volume
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-sm" id="volumesTable">
                                        <thead class="table-light">
                                            <tr>
                                                <th colspan="2" style="border-bottom: 1px solid #dee2e6;">Volume</th>
                                            </tr>
                                        </thead>
                                <tbody id="volumesTableBody">
                                    <tr>
                                        <td colspan="2" class="text-center text-muted">No volumes added yet. Click "Add Volume" to add one.</td>
                                    </tr>
                                </tbody>
                            </table>
                                </div>
                            </div>
                            <div class="card-footer bg-light">
                                <small class="text-muted">Volumes are accessible to all containers in the deployment via their mounted paths.</small>
                            </div>
                        </div>
                    </div>
                </div>

                        <!-- Container Instance Details Modal -->
                        <div class="modal fade" id="containerInstanceModal" tabindex="-1">
                            <div class="modal-dialog modal-xl">
                                <div class="modal-content">
                                    <div class="modal-header bg-primary text-white">
                                        <h5 class="modal-title">Container Instance Details</h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body" id="containerInstanceDetails">
                                        <p class="text-muted">Loading details...</p>
                                    </div>
                                    <div class="modal-footer" style="display: none;">
                                        <!-- Close button is now in the modal body, controlled by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Create Container Instance Modal -->
                        <div class="modal fade" id="createContainerInstanceModal" tabindex="-1">
                            <div class="modal-dialog modal-xl">
                                <div class="modal-content">
                                    <div class="modal-header bg-primary text-white">
                                        <h5 class="modal-title">Create Container Instance</h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="createContainerInstanceForm">
                                            <!-- Basic Information -->
                                            <div class="mb-4">
                                                <h5 class="border-bottom pb-2 mb-3">Basic Information</h5>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="ciName" class="form-label">Name <span class="text-danger">*</span></label>
                                                        <input type="text" class="form-control" id="ciName" required placeholder="my-container-instance">
                                                        <small class="form-text text-muted">Display name for the container instance</small>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="ciShape" class="form-label">Shape</label>
                                                        <input type="text" class="form-control" id="ciShape" value="CI.Standard.E4.Flex" readonly>
                                                        <small class="form-text text-muted">Container instance shape</small>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Compartment</label>
                                                        <input type="text" class="form-control" id="ciCompartmentName" readonly>
                                                        <small class="form-text text-muted">Compartment where the container instance will be created</small>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Subnet <span class="text-danger">*</span></label>
                                                        <select class="form-select" id="ciSubnetId" required>
                                                            <option value="">Loading subnets...</option>
                                                        </select>
                                                        <small class="form-text text-muted">Subnet where the container instance will be created</small>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Architecture <span class="text-danger">*</span></label>
                                                        <div>
                                                            <div class="form-check form-check-inline">
                                                                <input class="form-check-input" type="radio" name="ciArchitecture" id="ciArchX86" value="x86" checked required>
                                                                <label class="form-check-label" for="ciArchX86">x86</label>
                                                            </div>
                                                            <div class="form-check form-check-inline">
                                                                <input class="form-check-input" type="radio" name="ciArchitecture" id="ciArchARM64" value="ARM64" required>
                                                                <label class="form-check-label" for="ciArchARM64">ARM64</label>
                                                            </div>
                                                        </div>
                                                        <small class="form-text text-muted">Container instance architecture</small>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="ciShapeMemory" class="form-label">Shape Memory (GB) <span class="text-danger">*</span></label>
                                                        <select class="form-select" id="ciShapeMemory" required>
                                                            <option value="16" selected>16 GB</option>
                                                            <option value="32">32 GB</option>
                                                            <option value="64">64 GB</option>
                                                            <option value="96">96 GB</option>
                                                            <option value="128">128 GB</option>
                                                        </select>
                                                        <small class="form-text text-muted">Total memory for the container instance</small>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="ciShapeOcpus" class="form-label">Shape OCPUs <span class="text-danger">*</span></label>
                                                        <select class="form-select" id="ciShapeOcpus" required>
                                                            <option value="1" selected>1 OCPU</option>
                                                            <option value="2">2 OCPU</option>
                                                            <option value="3">3 OCPU</option>
                                                            <option value="4">4 OCPU</option>
                                                            <option value="5">5 OCPU</option>
                                                            <option value="6">6 OCPU</option>
                                                            <option value="7">7 OCPU</option>
                                                            <option value="8">8 OCPU</option>
                                                        </select>
                                                        <small class="form-text text-muted">Total OCPUs for the container instance</small>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Containers -->
                                            <div class="mb-4">
                                                <div class="d-flex justify-content-between align-items-center mb-3">
                                                    <h5 class="mb-0">Containers</h5>
                                                    <div>
                                                        <button type="button" class="btn btn-info btn-sm me-2" onclick="addContainerToTable()">
                                                            + Add Container
                                                        </button>
                                                        <button type="button" class="btn btn-secondary btn-sm" onclick="showAddSidecarModal()">
                                                            + Add Sidecar
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="table-responsive">
                                                    <table class="table table-sm" id="containersTable">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th style="border-bottom: 1px solid #dee2e6;">Name</th>
                                                                <th style="border-bottom: 1px solid #dee2e6;">Image</th>
                                                                <th colspan="2" style="border-bottom: 1px solid #dee2e6;">Port</th>
                                                                <th style="border-bottom: 1px solid #dee2e6;">Memory (GB)</th>
                                                                <th style="border-bottom: 1px solid #dee2e6;">VCPUs</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="containersTableBody">
                                                            <tr>
                                                                <td colspan="6" class="text-center text-muted" style="border-bottom: 1px solid #dee2e6;">No containers added yet. Click "Add Container" to add one.</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            
                                            <!-- Volumes -->
                                            <div class="mb-4">
                                                <div class="d-flex justify-content-between align-items-center mb-3">
                                                    <h5 class="mb-0">Volumes</h5>
                                                    <button type="button" class="btn btn-success btn-sm" onclick="addVolumeToTable()">
                                                        + Add Volume
                                                    </button>
                                                </div>
                                                <p class="text-muted small mb-2">Volumes are accessible to all containers in the deployment via their mounted paths.</p>
                                                <div class="table-responsive">
                                                    <table class="table table-sm" id="createVolumesTable">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th style="border-bottom: 1px solid #dee2e6;">Name</th>
                                                                <th colspan="2" style="border-bottom: 1px solid #dee2e6;">Path</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="createVolumesTableBody">
                                                            <tr>
                                                                <td colspan="3" class="text-center text-muted" style="border-bottom: 1px solid #dee2e6;">No volumes added yet. Click "Add Volume" to add one.</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="button" class="btn btn-primary" onclick="showCISummaryModal()"><i class="bi bi-arrow-right"></i> Next</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Add Sidecar Modal -->
                        <div class="modal fade" id="addSidecarModal" tabindex="-1">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header bg-secondary text-white">
                                        <h5 class="modal-title">Add Sidecar</h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p class="text-muted mb-3">Select a sidecar to add to your container instance:</p>
                                        <div class="row g-3" id="addSidecarModalBody">
                                            <p class="text-muted">Loading sidecars...</p>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Volume Edit Modal -->
                        <div class="modal fade" id="editVolumeModal" tabindex="-1">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header bg-success text-white">
                                        <h5 class="modal-title">Edit Volume</h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="editVolumeForm">
                                            <input type="hidden" id="editVolumeIndex">
                                            <div class="mb-3">
                                                <label for="editVolumePath" class="form-label">Path <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="editVolumePath" required placeholder="/path/to/mount">
                                                <small class="form-text text-muted">Volume mount path</small>
                                            </div>
                                            <div class="mb-3">
                                                <label for="editVolumeName" class="form-label">Name</label>
                                                <input type="text" class="form-control" id="editVolumeName" placeholder="Optional">
                                                <small class="form-text text-muted">Optional volume name</small>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="button" class="btn btn-success" onclick="saveEditedVolume()">Save Volume</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Port Edit Modal -->
                        <div class="modal fade" id="editPortModal" tabindex="-1">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header bg-warning text-dark">
                                        <h5 class="modal-title">Edit Port</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="editPortForm">
                                            <input type="hidden" id="editPortIndex">
                                            <div class="mb-3">
                                                <label for="editPortNumber" class="form-label">Port <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="editPortNumber" required min="1" max="65535">
                                                <small class="form-text text-muted">Port number (1-65535)</small>
                                            </div>
                                            <div class="mb-3">
                                                <label for="editPortName" class="form-label">Name</label>
                                                <input type="text" class="form-control" id="editPortName" placeholder="Optional">
                                                <small class="form-text text-muted">Optional port name</small>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="button" class="btn btn-warning" onclick="saveEditedPort()">Save Port</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Container Edit Modal -->
                        <div class="modal fade" id="editContainerModal" tabindex="-1">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header bg-info text-white">
                                        <h5 class="modal-title" id="editContainerModalTitle">Edit Container</h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="editContainerForm">
                                            <input type="hidden" id="editContainerIndex">
                                            <div class="mb-3">
                                                <label for="editContainerName" class="form-label">Name <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="editContainerName" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="editContainerImage" class="form-label">Image <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="editContainerImage" required placeholder="docker.io/library/nginx:latest">
                                                <small class="form-text text-muted">Container image URL</small>
                                            </div>
                                                <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="editContainerMemory" class="form-label">Memory (GB) <span class="text-danger">*</span></label>
                                                    <select class="form-select" id="editContainerMemory" required>
                                                        <option value="16" selected>16 GB</option>
                                                        <option value="32">32 GB</option>
                                                        <option value="64">64 GB</option>
                                                        <option value="96">96 GB</option>
                                                        <option value="128">128 GB</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="editContainerVcpus" class="form-label">vOCPU <span class="text-danger">*</span></label>
                                                    <select class="form-select" id="editContainerVcpus" required>
                                                        <option value="1" selected>1 vOCPU</option>
                                                        <option value="2">2 vOCPU</option>
                                                        <option value="3">3 vOCPU</option>
                                                        <option value="4">4 vOCPU</option>
                                                        <option value="5">5 vOCPU</option>
                                                        <option value="6">6 vOCPU</option>
                                                        <option value="7">7 vOCPU</option>
                                                        <option value="8">8 vOCPU</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <label for="editContainerPort" class="form-label mb-0">Port</label>
                                                    <button type="button" class="btn btn-warning btn-sm" onclick="showAddPortFromContainerEdit()">
                                                        <i class="bi bi-plus"></i> Add Port
                                                    </button>
                                                </div>
                                                <select class="form-select" id="editContainerPort">
                                                    <option value="">No port</option>
                                                </select>
                                                <small class="form-text text-muted">Select a port from the ports added above</small>
                                            </div>
                                            <!-- Tabs for Environment Variables, Arguments, and Command -->
                                            <div class="mb-3">
                                                <ul class="nav nav-tabs" id="containerTabs" role="tablist">
                                                    <li class="nav-item" role="presentation">
                                                        <button class="nav-link active" id="env-tab" data-bs-toggle="tab" data-bs-target="#env-pane" type="button" role="tab">Environment Variables</button>
                                                    </li>
                                                    <li class="nav-item" role="presentation">
                                                        <button class="nav-link" id="args-tab" data-bs-toggle="tab" data-bs-target="#args-pane" type="button" role="tab">Arguments</button>
                                                    </li>
                                                    <li class="nav-item" role="presentation">
                                                        <button class="nav-link" id="cmd-tab" data-bs-toggle="tab" data-bs-target="#cmd-pane" type="button" role="tab">Command</button>
                                                    </li>
                                                </ul>
                                                <div class="tab-content" id="containerTabsContent">
                                                    <div class="tab-pane fade show active" id="env-pane" role="tabpanel">
                                                        <label for="editContainerEnvVars" class="form-label mt-3">Environment Variables</label>
                                                        <input type="text" class="form-control" id="editContainerEnvVars" placeholder="KEY1=value1, KEY2=value2">
                                                        <small class="form-text text-muted">Comma-separated KEY=VALUE pairs</small>
                                                    </div>
                                                    <div class="tab-pane fade" id="args-pane" role="tabpanel">
                                                        <label for="editContainerArgs" class="form-label mt-3">Arguments</label>
                                                        <input type="text" class="form-control" id="editContainerArgs" placeholder="arg1, arg2, arg3">
                                                        <small class="form-text text-muted">Comma-separated values</small>
                                                    </div>
                                                    <div class="tab-pane fade" id="cmd-pane" role="tabpanel">
                                                        <label for="editContainerCmd" class="form-label mt-3">Command</label>
                                                        <input type="text" class="form-control" id="editContainerCmd" placeholder="cmd1, cmd2, cmd3">
                                                        <small class="form-text text-muted">Comma-separated values</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="button" class="btn btn-info" onclick="saveEditedContainer()">Save</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CI Summary Modal -->
                        <div class="modal fade" id="ciSummaryModal" tabindex="-1">
                            <div class="modal-dialog modal-xl">
                                <div class="modal-content">
                                    <div class="modal-header bg-secondary text-white">
                                        <h5 class="modal-title">Container Instance Summary</h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body" id="ciSummaryContent">
                                        <p class="text-muted">Loading summary...</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="button" class="btn btn-outline-primary" onclick="goBackToCreateCI()"><i class="bi bi-arrow-left"></i> Back</button>
                                        <button type="button" class="btn btn-primary" onclick="confirmCreateContainerInstance()">Create</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Import Docker Compose Modal -->
                        <div class="modal fade" id="importDockerComposeModal" tabindex="-1">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header bg-info text-white">
                                        <h5 class="modal-title"><i class="bi bi-upload"></i> Import Docker Compose</h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="importDockerComposeForm">
                                            <div class="mb-3">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <label for="composeYaml" class="form-label mb-0">Docker Compose YAML</label>
                                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="pasteComposeYaml()" title="Paste from clipboard">
                                                        <i class="bi bi-clipboard-check"></i> Paste
                                                    </button>
                                                </div>
                                                <textarea class="form-control font-monospace" id="composeYaml" rows="12" placeholder="version: '3.8'&#10;services:&#10;  app:&#10;    image: nginx:latest&#10;    ports:&#10;      - &quot;8080:8080&quot;"></textarea>
                                                <small class="form-text text-muted">Paste your Docker Compose YAML content here</small>
                                            </div>
                                            <div class="mb-3">
                                                <label for="composeFileUpload" class="form-label">Or Upload File</label>
                                                <input type="file" class="form-control" id="composeFileUpload" accept=".yaml,.yml">
                                                <small class="form-text text-muted">Select a docker-compose.yml or docker-compose.yaml file</small>
                                            </div>
                                            <hr>
                                            <h6 class="mb-3">OCI Configuration</h6>
                                            <div class="mb-3">
                                                <label for="importCompartmentId" class="form-label">Compartment</label>
                                                <select class="form-select" id="importCompartmentId" required>
                                                    <option value="">Loading compartments...</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label for="importSubnetId" class="form-label">Subnet</label>
                                                <select class="form-select" id="importSubnetId" required>
                                                    <option value="">Select compartment first</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Architecture</label>
                                                <div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="radio" name="importArchitecture" id="importArchitectureX86" value="x86" checked>
                                                        <label class="form-check-label" for="importArchitectureX86">x86</label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="radio" name="importArchitecture" id="importArchitectureARM64" value="ARM64">
                                                        <label class="form-check-label" for="importArchitectureARM64">ARM64</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="importDependencyDelay" class="form-label">Dependency Delay (seconds)</label>
                                                <input type="number" class="form-control" id="importDependencyDelay" value="10" min="1" max="300">
                                                <small class="form-text text-muted">Delay for dependencies without ports (default: 10 seconds)</small>
                                            </div>
                                            <div id="importWarnings" class="alert alert-warning" style="display: none;">
                                                <strong>Warnings:</strong>
                                                <ul id="importWarningsList" class="mb-0"></ul>
                                            </div>
                                            <div id="importErrors" class="alert alert-danger" style="display: none;">
                                                <strong>Errors:</strong>
                                                <ul id="importErrorsList" class="mb-0"></ul>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="button" class="btn btn-primary" onclick="importToCreateCI()">Import to Create CI</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Configuration Modal -->
                        <div class="modal fade" id="configModal" tabindex="-1">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header bg-primary text-white">
                                        <h5 class="modal-title">Configuration</h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="configForm">
                                            <div class="mb-3">
                                                <label for="projectName" class="form-label">CI Name</label>
                                                <input type="text" class="form-control" id="projectName" placeholder="My CI">
                                                <small class="form-text text-muted">Name for container instances and settings</small>
                                            </div>
                                            <div class="mb-3">
                                                <label for="ociConfigFile" class="form-label">OCI Config File Path</label>
                                                <input type="text" class="form-control" id="ociConfigFile" placeholder="~/.oci/config">
                                                <small class="form-text text-muted">Path to OCI configuration file</small>
                                            </div>
                                            <div class="mb-3">
                                                <label for="ociConfigProfile" class="form-label">OCI Config Profile</label>
                                                <input type="text" class="form-control" id="ociConfigProfile" placeholder="DEFAULT">
                                                <small class="form-text text-muted">Profile name in OCI config file</small>
                                            </div>
                                            <div class="mb-3">
                                                <label for="region" class="form-label">Region</label>
                                                <div class="input-group">
                                                    <input type="text" class="form-control" id="region" placeholder="us-ashburn-1">
                                                    <button class="btn btn-outline-secondary" type="button" onclick="loadRegionFromConfig()">
                                                        <small>Load from Config</small>
                                                    </button>
                                                </div>
                                                <small class="form-text text-muted">OCI Region (e.g., us-ashburn-1, us-phoenix-1) - Auto-loaded from config file when available</small>
                                            </div>
                                            <div class="mb-3">
                                                <label for="compartmentId" class="form-label">Compartment <span class="text-danger">*</span></label>
                                                <div class="input-group">
                                                    <select class="form-select" id="compartmentId" required onchange="loadSubnets(); loadLogGroups();">
                                                        <option value="">Loading compartments...</option>
                                                    </select>
                                                    <button class="btn btn-outline-secondary" type="button" onclick="loadCompartments()">
                                                        <small>Refresh</small>
                                                    </button>
                                                </div>
                                                <small class="form-text text-muted">OCI Compartment for resource operations</small>
                                            </div>
                                            <div class="mb-3">
                                                <label for="subnetId" class="form-label">Default Subnet <span class="text-danger">*</span></label>
                                                <div class="input-group">
                                                    <select class="form-select" id="subnetId" required>
                                                        <option value="">Select a compartment first...</option>
                                                    </select>
                                                    <button class="btn btn-outline-secondary" type="button" onclick="loadSubnets()">
                                                        <small>Refresh</small>
                                                    </button>
                                                </div>
                                                <small class="form-text text-muted">OCI Subnet</small>
                                            </div>
                                            <div class="mb-3">
                                                <label for="logGroupId" class="form-label">Default Log Group</label>
                                                <select class="form-select" id="logGroupId">
                                                    <option value="">Loading log groups...</option>
                                                </select>
                                                <small class="form-text text-muted">OCI Log Group for container logs</small>
                                            </div>
                                            <div class="mb-3">
                                                <label for="autoReloadTime" class="form-label">Auto-Reload Time (seconds)</label>
                                                <input type="number" class="form-control" id="autoReloadTime" min="0" value="5" placeholder="5">
                                                <small class="form-text text-muted">Auto-reload interval in seconds (0 = disabled)</small>
                                            </div>
                                            <div class="alert alert-info">
                                                <strong>Note:</strong> These settings are stored in your browser's local storage and are used for API requests.
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="button" class="btn btn-primary" onclick="saveConfiguration()">Save Configuration</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Container Logs Modal -->
    <div class="modal fade" id="containerLogsModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-right">
            <div class="modal-content">
                <div class="modal-header bg-secondary text-white">
                    <h5 class="modal-title" id="containerLogsModalTitle">Container Logs</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="containerLogsContent" style="max-height: 500px; overflow-y: auto;">
                        <p class="text-muted">Loading logs...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div class="modal fade" id="aboutModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">About CI Compose</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-4">
                        <h4 class="mb-3">CI Compose</h4>
                        <p class="lead">
                            CI Compose is a comprehensive management tool designed for Oracle Cloud Infrastructure (OCI) Container Instances. 
                            It provides an intuitive interface for creating, configuring, and managing container instances with support for 
                            multiple containers, sidecars, volumes, and networking configurations.
                        </p>
                        <div class="alert alert-warning mt-3" role="alert">
                            <strong>Notice:</strong> This software (version 0.1.0) is currently intended for experimental use and evaluation purposes. 
                            It is not recommended for production environments at this time.
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h5 class="mb-3">Features</h5>
                        <ul>
                            <li>Create and manage OCI Container Instances</li>
                            <li>Configure containers with custom images, sidecars, resource limits, and environment variables</li>
                            <li>Manage sidecars from the Sidecar Gallery (stock and custom sidecars)</li>
                            <li>Configure networking with port mappings and subnet selection. Subnet security lists are not modified automatically and must be updated manually as required.</li>
                            <li>Manage volumes and volume mounts shared between containers for data exchange</li>
                            <li>View container logs (using OCI Logging sidecar) and instance details</li>
                            <li>Edit, restart, stop, and delete container instances</li>
                            <li>Restore deleted container instances with the same configuration (volumes and subnet are recreated from current configuration)</li>
                            <li>Export Container Instances configurations to OCI Resource Manager (Terraform)</li>
                            <li>Import Docker Compose YAML files to quickly set up Container Instances</li>
                        </ul>
                    </div>
                    
                    <div class="mb-4">
                        <h5 class="mb-3">Docker Compose Import</h5>
                        <p>
                            CI Compose supports importing Docker Compose YAML files to quickly set up OCI Container Instances. 
                            This feature allows you to import standard Docker Compose configurations and convert them to OCI Container Instances.
                        </p>
                        <p class="small text-muted">
                            Supported features: <code>image</code>, <code>command</code>, <code>entrypoint</code>, 
                            <code>environment</code>, <code>ports</code>, <code>volumes</code>, and <code>depends_on</code>.
                        </p>
                    </div>
                    
                    <div class="mb-4">
                        <h5 class="mb-3">CI/CD Integration</h5>
                        <p>
                            Once a Container Instance is created (either manually or from a Docker Compose YAML), 
                            you can export it to OCI Resource Manager (Terraform) for CI/CD pipeline integration.
                        </p>
                        <p class="small text-muted mb-2">
                            <strong>Example: Create/Update Stack using OCI CLI</strong>
                        </p>
                        <pre class="bg-light p-2 rounded small"><code># Create or update an OCI Resource Manager Stack
oci resource-manager stack create \
  --compartment-id &lt;compartment-ocid&gt; \
  --display-name "my-container-instance-stack" \
  --config-source file-uri \
  --working-directory ./terraform \
  --terraform-version "1.5.x"

# Apply the stack (create/update resources)
oci resource-manager job create-apply-job \
  --stack-id &lt;stack-ocid&gt; \
  --execution-plan-strategy AUTO_APPROVED</code></pre>
                        <p class="small text-muted mt-2">
                            The exported Terraform configuration can be included in your CI/CD pipeline using the OCI CLI. 
                            This enables version control, automated deployments, and infrastructure as code practices.
                        </p>
                    </div>
                    
                    <div class="mb-4">
                        <h5 class="mb-3">Custom Sidecars</h5>
                        <p>
                            If you want to add a custom sidecar to this project, please contact 
                            <a href="mailto:mika.rinne@oracle.com">mika.rinne@oracle.com</a>.
                        </p>
                    </div>
                    
                    <div class="mb-4">
                        <h5 class="mb-3">License</h5>
                        <p>
                            This software is licensed under the Universal Permissive License (UPL), Version 1.0.
                        </p>
                        <p class="small text-muted">
                            The Universal Permissive License (UPL) is a permissive open source license that allows 
                            you to use, modify, and distribute the software with minimal restrictions.
                        </p>
                    </div>
                    
                    <div class="mb-4">
                        <h5 class="mb-3">Contact</h5>
                        <p>
                            For questions, support, or inquiries, please contact:
                        </p>
                        <p>
                            <strong>Mika Rinne</strong><br>
                            <a href="mailto:mika.rinne@oracle.com">mika.rinne@oracle.com</a>
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidecar Gallery Modal -->
    <div class="modal fade" id="sidecarGalleryModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-secondary text-white">
                    <h5 class="modal-title">Sidecar Gallery</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0">Stock Sidecars</h6>
                        <button type="button" class="btn btn-success btn-sm" onclick="showAddCustomSidecarModal()">
                            <i class="bi bi-plus"></i> Add Custom Sidecar
                        </button>
                    </div>
                    <div id="defaultSidecarsContainer" class="row g-3 mb-4">
                        <p class="text-muted">Loading sidecars...</p>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0">Custom Sidecars</h6>
                    </div>
                    <div id="customSidecarsContainer" class="row g-3">
                        <p class="text-muted">No custom sidecars yet. Click "Add Custom Sidecar" to create one.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View/Edit Sidecar Modal -->
    <div class="modal fade" id="viewSidecarModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-secondary text-white">
                    <h5 class="modal-title" id="viewSidecarModalTitle">Sidecar Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="viewSidecarForm">
                        <input type="hidden" id="viewSidecarId">
                        <input type="hidden" id="viewSidecarIsDefault">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="viewSidecarName" class="form-label">Name</label>
                                <input type="text" class="form-control" id="viewSidecarName" readonly>
                            </div>
                            <div class="col-md-6">
                                <label for="viewSidecarImage" class="form-label">Image</label>
                                <input type="text" class="form-control" id="viewSidecarImage" readonly>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="viewSidecarArch" class="form-label">Architecture</label>
                                <input type="text" class="form-control" id="viewSidecarArch" readonly>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Memory (GB)</label>
                                <input type="text" class="form-control" id="viewSidecarMem" readonly>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">OCPUs</label>
                                <input type="text" class="form-control" id="viewSidecarOcpu" readonly>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="viewSidecarPort" class="form-label">Port</label>
                                <input type="text" class="form-control" id="viewSidecarPort" readonly>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Environment Variables</label>
                            <small class="form-text text-muted d-block mb-2">These environment variables must be configured by the user when deploying the sidecar, unless the provided defaults are appropriate. Variables that reference file system paths require a volume to be provisioned with a matching mount path.</small>
                            <div id="viewSidecarEnvs" class="border rounded p-2 bg-light">
                                <p class="text-muted mb-0">No environment variables</p>
                            </div>
                        </div>
                        <div id="defaultSidecarDefaultsSection" style="display: none;">
                            <hr>
                            <h6>Default Values (Saved)</h6>
                            <p class="text-muted small">These values will be used when adding this sidecar to a container instance.</p>
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="defaultSidecarPort" class="form-label">Port</label>
                                    <input type="text" class="form-control" id="defaultSidecarPort">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Memory (GB)</label>
                                    <select class="form-select" id="defaultSidecarMem">
                                        <option value="">Select...</option>
                                        <option value="16">16</option>
                                        <option value="32">32</option>
                                        <option value="64">64</option>
                                        <option value="96">96</option>
                                        <option value="128">128</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">OCPUs</label>
                                    <select class="form-select" id="defaultSidecarOcpu">
                                        <option value="">Select...</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Environment Variables</label>
                                <div id="defaultSidecarEnvs" class="border rounded p-2">
                                    <p class="text-muted mb-0">No environment variables</p>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-danger" id="deleteCustomSidecarBtn" style="display: none;" onclick="deleteCustomSidecar()">Delete</button>
                    <button type="button" class="btn btn-warning" id="editCustomSidecarBtn" style="display: none;" onclick="editCustomSidecar()">Edit</button>
                    <button type="button" class="btn btn-primary" id="saveDefaultsBtn" style="display: none;" onclick="saveSidecarDefaults()">Save Defaults</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Custom Sidecar Modal -->
    <div class="modal fade" id="addEditCustomSidecarModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="addEditCustomSidecarModalTitle">Add Custom Sidecar</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addEditCustomSidecarForm">
                        <input type="hidden" id="editCustomSidecarId">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="editCustomSidecarName" class="form-label">Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="editCustomSidecarName" required>
                            </div>
                            <div class="col-md-6">
                                <label for="editCustomSidecarImage" class="form-label">Image <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="editCustomSidecarImage" required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="editCustomSidecarArch" class="form-label">Architecture</label>
                                <select class="form-select" id="editCustomSidecarArch">
                                    <option value="">Select...</option>
                                    <option value="x86">x86</option>
                                    <option value="ARM64">ARM64</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="editCustomSidecarMem" class="form-label">Memory (GB)</label>
                                <select class="form-select" id="editCustomSidecarMem">
                                    <option value="">Select...</option>
                                    <option value="16">16</option>
                                    <option value="32">32</option>
                                    <option value="64">64</option>
                                    <option value="96">96</option>
                                    <option value="128">128</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="editCustomSidecarOcpu" class="form-label">OCPUs</label>
                                <select class="form-select" id="editCustomSidecarOcpu">
                                    <option value="">Select...</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="editCustomSidecarPort" class="form-label">Port</label>
                                <input type="text" class="form-control" id="editCustomSidecarPort" placeholder="e.g., 8080">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Environment Variables</label>
                            <small class="form-text text-muted d-block mb-2">These environment variables must be configured by the user when deploying the sidecar, unless the provided defaults are appropriate. Variables that reference file system paths require a volume to be provisioned with a matching mount path.</small>
                            <div id="editCustomSidecarEnvs" class="border rounded p-2 mb-2">
                                <p class="text-muted mb-2">No environment variables added</p>
                            </div>
                            <button type="button" class="btn btn-sm btn-secondary" onclick="addEnvToCustomSidecar()">
                                <i class="bi bi-plus"></i> Add Environment Variable
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveCustomSidecar()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="js/main.js"></script>
</body>
</html>
